Model-View-Controller architecture

Model
-----

See sql/zoo.sql.


Views
-----

Resource representations (need a Template Toolkit View/template, and ideally a DTD, for each of these):

Lock: (LockID, WorldID, LockOwnerUserID, ToolName+, ExpirationTime)
WorldStatus: (WorldID, LockID?, WorldOwnerUserID, NextAvailableCheckoutTime)
Turn: (PlayerUserID, LockID, MoveLog, UpdatedBoard, OwnershipWinFlag)
Type: (TypeName, TypeDependency*, TypeImageName, Particle)
PixelPrice: (TypeName, CashPerPixel)
Status: (UserID?, UserName, Password?, AvatarImageName, AllowedRole+, OwnedWorldID*, CashLevel, (OwnedPixelTypeName,NumberOfPixelsOwned)+, NextPixelPurchaseOrderID)
PixelPurchaseOrder: ((UserID, OrderID, TypeName, CashAmount)+)
Image: SVG

WorldGame = Game without Board
Tool, Game, Board, Proto, etc. as per current definitions.



Controllers
-----------

RESTful HTTP operations & responses.
All can return 401 Unauthorized for authentication (incl. challenge URL)

World controller
----------------

GET world  -->    200 Success + WorldStatus list

GET world/WorldID/board  -->    200 Success + Board (HTTP headers: "Last-Modified"=last move), 404 Not Found (bad WorldID)
GET world/WorldID/status  -->   200 Success + WorldStatus (HTTP headers: "Last-Modified"=last change of owner), 404 Not Found (bad WorldID)

GET world/WorldID/owner  -->    200 Success + WorldGame, 404 Not Found (bad WorldID)
GET world/WorldID/guest  -->    200 Success + WorldGame, 404 Not Found (bad WorldID)
GET world/WorldID/voyeur  -->   200 Success + WorldGame, 404 Not Found (bad WorldID)

GET world/WorldID/view  -->            200 Success + Proto (assembles Board with voyeur Game wrapper and no Tools), 404 Not Found (bad WorldID), 408 Request Timeout
GET world/WorldID/view/compiled  -->   200 Success + Game (assembles & compiles Board with voyeur Game wrapper and no Tools), 404 Not Found (bad WorldID), 408 Request Timeout

GET world/WorldID/lock  -->  303 See Other --> GET world/WorldID/lock/LockID, 404 Not Found
POST world/WorldID/lock (ToolName+)  -->  201 Created + Lock (HTTP headers: "Location: world/WorldID//lock/LockID"), 404 Not Found (bad WorldID), 408 Request Timeout (assembly fail), 423 Locked (someone else's lock), 409 Conflict (too soon since last lock)

GET world/WorldID/lock/LockID  -->  200 Success + Lock (HTTP headers: "Expires"=expiration time, "Last-Modified"=creation time), 404 Not Found
DELETE world/WorldID/lock/LockID  -->  204 No Content (success), 404 Not Found (bad WorldID or LockID), 410 Gone (lock expired)

GET world/WorldID/lock/LockID/view  -->            200 Success + Proto (HTTP headers: "Last-Modified"=lock creation time), 404 Not Found (bad WorldID or LockID)
GET world/WorldID/lock/LockID/view/compiled  -->   200 Success + Game (HTTP headers: same as proto) (compiles, caches results), 404 Not Found (bad WorldID or LockID), 408 Request Timeout (failed to compile)

GET world/WorldID/lock/LockID/turn  -->       403 Forbidden (currently unimplemented; eventually, shows current turn, if uploaded)
GET world/WorldID/lock/LockID/turn/valid  --> 403 Forbidden (currently unimplemented; eventually, validates current turn, if uploaded)

POST world/WorldID/turn (Turn) -->  204 No Content (success), 410 Gone (lock expired), 423 Locked (not your lock), 403 Forbidden (illegal turn), 402 Payment Required, 413 Request Entity Too Large


Store controller
----------------

GET store/type/TypeName  -->  200 Success + Type (HTTP headers: "Last-Modified"), 404 Not Found (bad TypeName)
PUT store/type/TypeName (Type)  -->  204 No Content (success), 403 Forbidden (no coder/hacker privileges), 402 Payment Required, 413 Request Entity Too Large
POST store/type (Type)  -->  403 Forbidden (currently unimplemented; eventually, redirect internally to "PUT store/type/TypeName" and return a 303 to "GET store/type/TypeName")

GET store/tool/ToolName  -->  200 Success + Tool (HTTP headers: "Last-Modified"), 404 Not Found (bad ToolName)
PUT store/tool/ToolName (Tool)  -->  204 No Content (success), 403 Forbidden (no smith/maker privileges), 402 Payment Required, 413 Request Entity Too Large
POST store/tool (Tool)  -->  403 Forbidden (currently unimplemented; eventually, redirect internally to "PUT store/tool/ToolName" and return a 303 to "GET store/tool/ToolName")

GET store/image/ImageName  -->  200 Success + Image (HTTP headers: "Last-Modified"), 404 Not Found (bad ImageName)
PUT store/image/ImageName (Image)  -->  204 No Content (success), 403 Forbidden (no artist/vandal privileges), 402 Payment Required, 413 Request Entity Too Large
POST store/image (Image)  -->  403 Forbidden (currently unimplemented; eventually, redirect internally to "PUT store/image/ImageName" and return a 303 to "GET store/image/ImageName")

GET store/price/type/TypeName  -->  200 Success + PixelPrice (HTTP headers: "Expires") (for the moment just returns default price), 404 Not Found (bad TypeName)

GET store/order/type  -->  200 Success + PixelPurchaseOrder (HTTP headers: "Last-Modified"=time of last pixel purchase) (account history)
POST store/order/type  (PixelPurchaseOrder)  -->  201 Success, 402 Payment Required, 404 Not Found


User controller
---------------

GET user/login/UserID/Password  -->  204 No Content (success), 404 Not Found (bad UserID), 403 Forbidden (wrong password)

GET user/logout  -->  204 No Content (success)

GET user/status  -->  internally redirect to "GET user/status/UserID"
POST user/status  (Status)   -->  201 Created + Status (success), 409 Conflict (username taken)

GET user/status/UserID  -->  200 Success + Status, 404 Not Found (bad UserID)
PUT user/status/UserID  (Status)  -->  200 Success + Status
