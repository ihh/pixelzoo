Model-View-Controller architecture

Model
-----

Local database:
User table (UserName, MainRole, Cash)
User inventory table (UserName, TypeName, PixelCount)
Board metadata table (BoardID, BoardName, BoardSize, BoardTime, BoardOwnerName, BoardLockExpiryTime, BoardLockCount, BoardLockCreatorName)

S3 bucket:
type/TypeName = type/CreatorName/RestOfTypeName
board/BoardID
game/BoardID
compiled/BoardID


Comments:

BoardID
 This is an integer primary key.

BoardName
 is never used as a key, and is not required to be unique.

UserName, TypeName
 These are strings that serve as primary keys in their respective tables, and so must be unique.
 Allowed characters in UserName: [A-Za-z0-9_.]
 TypeName always has the format "CreatorName/RestOfTypeName" where CreatorName is a UserName

MainRole: Player < Creator

Times (StartTime, ExpirationTime, NextAvailableCheckoutTime, MoveTime)
 board-specific, but generally 64-bit integers measuring (approx) nanoseconds of on-time since deployment.

Cash amounts (CashLevel, CashValue) are measured in virtual dollars, at parity with US$.

XML contents of bucket:
type/CreatorName/RestOfTypeName  leads to  <particle>
board/BoardID  leads to a  <board>  block in proto.dtd
game/BoardID  leads to the outer part of a  <game>  block in proto.dtd, excluding the  <board>
compiled/BoardID  leads to the  <board>  block in game.dtd


Views
-----

Resource representations:

Lock: (LockID, BoardID, LockOwnerName, ExpirationTime)
Board: (BoardID, LockID?, BoardOwnerName, NextAvailableCheckoutTime, GameData)
Move: ((PlayerName, MoveTime, X, Y, TypeName)+)
Type: (TypeName, TypeImage, TypeRule)
Price: (CashPerPixel)
Status: (UserName, (AllowedRole)+, BoardsOwned, CashLevel, (TypeName,PixelsOwned)+)
PixelPurchase: (BuyerName, TypeName, CashAmount)


Comments:

The appearance of a "lock collection" is maintained as a RESTful illusion; there can only ever be at most one lock per board.
LockID is just the lock count.

GameData is synthesized dynamically from BucketURL/(game|board|compiled)/*
If player doesn't have a lock, game/ & board/ are used, and the view conforms to proto.dtd.
If player has lock, game/ & compiled/ are used, view conforms to game.dtd.

Cash amounts are measured in virtual dollars, at parity with US$.


Controller
----------

RESTful HTTP operations & responses.
All can return 401 Unauthorized for authentication (incl. challenge URL)

GET lock/BoardID  -->  303 See Other --> GET lock/BoardID/LockID, 404 Not Found
GET lock/BoardID/LockID  -->  200 Success + Lock, 404 Not Found
POST lock/BoardID (null)  -->  200 Success + Lock (board compiled), 404 Not Found (bad BoardID), 408 Request Timeout (failed to compile board), 423 Locked (someone else's lock), 409 Conflict (too soon since last lock)
DELETE lock/BoardID/LockID  -->  204 No Content (success), 404 Not Found (bad BoardID or LockID), 410 Gone (timeout)

GET board/BoardID  -->   200 Success + Board (if lock is yours, Board includes rules + appropriate tools; otherwise, just type names), 404 Not Found (bad BoardID)

POST move/BoardID (Move) -->  204 No Content (success), 410 Gone (timeout), 423 Locked (not your lock), 403 Forbidden (illegal move), 402 Payment Required

GET type/TypeName  -->  200 Success + Type (proxies S3 bucket), 404 Not Found (bad TypeName)
PUT type (Type)  -->  201 Success + Type, 405 Method Not Allowed (type exists), 403 Forbidden (no designer privileges, not your namespace, etc), 402 Payment Required

GET price/TypeName  -->  200 Success + Type (for the moment just returns default price), 404 Not Found (bad TypeName)

GET status  -->  200 Success + Status

PUT buy  (PixelPurchase)  -->  201 Success, 402 Payment Required, 404 Not Found
