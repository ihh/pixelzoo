<xml>
  <game>

    <goal type="and">
      <lazy/>
      <goal type="cached">
	<goal type="population">
	  <type>1</type>
	  <type>2</type>
	  <count><min>20</min></count>
	</goal>
      </goal>
      <goal type="cached">
	<reps>3</reps>
	<goal type="print">
	  <text>You have reached your population target.
	    I will say this three times.</text>
	</goal>
      </goal>
      <goal type="cached">
	<goal type="repeat">
	  <reps>5</reps>
	  <goal type="print">
	    <text>(pauses for effect)</text>
	  </goal>
	</goal>
      </goal>
      <goal type="cached">
	<goal type="and">
	  <lazy/>
	  <cached/>
	  <goal type="print"><text>The portal is opening...</text></goal>
	  <goal type="print"><text>...wait for it...</text></goal>
	  <goal type="print"><text>...right about NOW!</text></goal>
	</goal>
      </goal>
      <goal type="cached">
	<goal type="setexit">
	  <state>PortalCounting</state>
	</goal>
      </goal>
    </goal>

    <rate>240</rate> <!-- 240 updates/second is about as fast as we can clock it -->

    <tool>
      <name>tool1</name>
      <size>8</size>
      <hexstate>1000000000000</hexstate>
      <reserve>100</reserve>
      <recharge>100</recharge>
    </tool>

    <tool>
      <name>tool2</name>
      <size>4</size>
      <hexstate>2000000000000</hexstate>
      <reserve>50</reserve>
      <recharge>100</recharge>
    </tool>

    <entrance><x>10</x><y>10</y><hexstate>10000</hexstate><count>10</count><rate>.001</rate></entrance>
    <exit><loc><x>12</x><y>12</y></loc><type>1</type><count>10</count></exit>
    <board><size>128</size>

      <grammar>

	<particle>
	  <sync/><shuffle/>
	  <name>drifter</name><type>1</type><color><mask>3</mask><hexmul>80000</hexmul></color><color><mask>0</mask><hexinc>80ffff</hexinc></color>
	  <rate>.03</rate>

	  <rule type="random"><prob>.05</prob>
	    <pass><rule type="random"><prob>.6</prob>
		<pass><rule type="modify"><rshift>64</rshift>
		</rule></pass>
		<fail><rule type="modify"><src></src><dest><x>1</x></dest>
		</rule></fail>
	    </rule></pass>
	    <fail><rule type="random">   <!-- x or y -->
		<pass><rule type="random">   <!-- right(+1) or left(-1) -->

		    <pass><rule type="switch">
			<pos><x>1</x></pos>
			<case><state>0</state><rule type="modify">
			    <rshift>64</rshift>
			    <next><rule type="modify">
				<src><x>1</x></src><dest></dest><hexinc>49</hexinc><srcmask>ff9</srcmask>
				<next><rule type="modify">
				    <dest><x>1</x></dest><rshift>64</rshift><hexinc>1000000000001</hexinc>
				</rule></next>
			    </rule></next>
			</rule></case>
		    </rule></pass>

		    <fail><rule type="switch">
			<pos><x>-1</x></pos>
			<case><state>0</state><rule type="modify">
			    <rshift>64</rshift>
			    <next><rule type="modify">
				<src><x>-1</x></src><dest></dest><hexinc>49</hexinc><srcmask>ff9</srcmask>
				<next><rule type="modify">
				    <dest><x>-1</x></dest><rshift>64</rshift><hexinc>1000000000001</hexinc>
				</rule></next>
			    </rule></next>
			</rule></case>
		    </rule></fail>

		</rule></pass>
		<fail><rule type="random">   <!-- down(+1) or up(-1) -->

		    <pass><rule type="switch">
			<pos><y>1</y></pos>
			<case><state>0</state><rule type="modify">
			    <rshift>64</rshift>
			    <next><rule type="modify">
				<src><y>1</y></src><dest></dest><hexinc>49</hexinc><srcmask>ff9</srcmask>
				<next><rule type="modify">
				    <dest><y>1</y></dest><rshift>64</rshift><hexinc>1000000000001</hexinc>
				</rule></next>
			    </rule></next>
			</rule></case>
		    </rule></pass>

		    <fail><rule type="switch">
			<pos><y>-1</y></pos>
			<case><state>0</state><rule type="modify">
			    <rshift>64</rshift>
			    <next><rule type="modify">
				<src><y>-1</y></src><dest></dest><hexinc>49</hexinc><srcmask>ff9</srcmask>
				<next><rule type="modify">
				    <dest><y>-1</y></dest><rshift>64</rshift><hexinc>1000000000001</hexinc>
				</rule></next>
			    </rule></next>
			</rule></case>
		    </rule></fail>

		</rule></fail>
	    </rule></fail>
	  </rule>
	</particle>

	<particle><name>stepper</name><type>2</type><color><mask>3</mask><hexmul>80000</hexmul></color><color><mask>0</mask><hexinc>ffff</hexinc></color>
	  <rate>.0009</rate>
	</particle>

      </grammar><init><x>64</x><y>64</y><type>1</type></init></board>
  </game>
</xml>
