  <game>
    <board><size>128</size>

      <grammar>

	<particle>
	  <name>drifter</name>
	  <type>1</type>
	  <colrule><mask>3</mask><hexmul>80000</hexmul></colrule><colrule><mask>0</mask><hexinc>80ffff</hexinc></colrule>
	  <sync/>
	  <rate>.03</rate>

	  <rule><random><prob>.05</prob>
	    <pass><rule><random><prob>.55</prob>
		<pass><rule><modify><srcmask>0</srcmask>
		</modify></rule></pass>
		<fail><rule><modify><srcmask>0</srcmask><hexinc>2000000000000</hexinc><dest><x>1</x></dest>
		</modify></rule></fail>
	    </random></rule></pass>
	    <fail><rule><random>   <!-- x or y -->
		<pass><rule><random>   <!-- right(+1) or left(-1) -->

		    <pass><rule><switch>
			<pos><x>1</x></pos>
			<mask>ffff000000000000</mask>
			<case><state>0</state><rule><modify>
			    <srcmask>0</srcmask>
			    <next><rule><modify>
				<src><x>1</x></src><srcmask>ff9</srcmask><hexinc>49</hexinc><dest></dest>
				<next><rule><modify>
				    <srcmask>0</srcmask><hexinc>1000000000001</hexinc><dest><x>1</x></dest>
				</modify></rule></next>
			    </modify></rule></next>
			</modify></rule></case>
		    </switch></rule></pass>

		    <fail><rule><switch>
			<pos><x>-1</x></pos>
			<mask>ffff000000000000</mask>
			<case><state>0</state><rule><modify>
			    <srcmask>0</srcmask>
			    <next><rule><modify>
				<src><x>-1</x></src><srcmask>ff9</srcmask><hexinc>49</hexinc><dest></dest>
				<next><rule><modify>
				    <srcmask>0</srcmask><hexinc>1000000000001</hexinc><dest><x>-1</x></dest>
				</modify></rule></next>
			    </modify></rule></next>
			</modify></rule></case>
		    </switch></rule></fail>

		</random></rule></pass>
		<fail><rule><random>   <!-- down(+1) or up(-1) -->

		    <pass><rule><switch>
			<pos><y>1</y></pos>
			<mask>ffff000000000000</mask>
			<case><state>0</state><rule><modify>
			    <srcmask>0</srcmask>
			    <next><rule><modify>
				<src><y>1</y></src><srcmask>ff9</srcmask><hexinc>49</hexinc><dest></dest>
				<next><rule><modify>
				    <srcmask>0</srcmask><hexinc>1000000000001</hexinc><dest><y>1</y></dest>
				</modify></rule></next>
			    </modify></rule></next>
			</modify></rule></case>
		    </switch></rule></pass>

		    <fail><rule><switch>
			<pos><y>-1</y></pos>
			<mask>ffff000000000000</mask>
			<case><state>0</state><rule><modify>
			    <srcmask>0</srcmask>
			    <next><rule><modify>
				<src><y>-1</y></src><srcmask>ff9</srcmask><hexinc>49</hexinc><dest></dest>
				<next><rule><modify>
				    <srcmask>0</srcmask><hexinc>1000000000001</hexinc><dest><y>-1</y></dest>
				</modify></rule></next>
			    </modify></rule></next>
			</modify></rule></case>
		    </switch></rule></fail>

		</random></rule></fail>
	    </random></rule></fail>
	  </random></rule>
	</particle>

	<particle><name>stepper</name><type>2</type><colrule><mask>3</mask><hexmul>80000</hexmul></colrule><colrule><mask>0</mask><hexinc>ffff</hexinc></colrule>
	  <rate>.03</rate>

	  <rule><random><prob>.05</prob>
	    <pass><rule><random><prob>.55</prob>
		<pass><rule><modify><srcmask>0</srcmask>
		</modify></rule></pass>
		<fail><rule><modify><srcmask>0</srcmask><hexinc>1000000000000</hexinc><dest><x>1</x></dest>
		</modify></rule></fail>
	    </random></rule></pass>
	    <fail><rule><random>   <!-- x or y -->
		<pass><rule><random>   <!-- right(+1) or left(-1) -->

		    <pass><rule><switch>
			<pos><x>1</x></pos>
			<mask>ffff000000000000</mask>
			<case><state>0</state><rule><modify>
			    <srcmask>0</srcmask>
			    <next><rule><modify>
				<src><x>1</x></src><srcmask>ff9</srcmask><hexinc>49</hexinc><dest></dest>
				<next><rule><modify>
				    <srcmask>0</srcmask><hexinc>2000000000001</hexinc><dest><x>1</x></dest>
				</modify></rule></next>
			    </modify></rule></next>
			</modify></rule></case>
		    </switch></rule></pass>

		    <fail><rule><switch>
			<pos><x>-1</x></pos>
			<mask>ffff000000000000</mask>
			<case><state>0</state><rule><modify>
			    <srcmask>0</srcmask>
			    <next><rule><modify>
				<src><x>-1</x></src><srcmask>ff9</srcmask><hexinc>49</hexinc><dest></dest>
				<next><rule><modify>
				    <srcmask>0</srcmask><hexinc>2000000000001</hexinc><dest><x>-1</x></dest>
				</modify></rule></next>
			    </modify></rule></next>
			</modify></rule></case>
		    </switch></rule></fail>

		</random></rule></pass>
		<fail><rule><random>   <!-- down(+1) or up(-1) -->

		    <pass><rule><switch>
			<pos><y>1</y></pos>
			<mask>ffff000000000000</mask>
			<case><state>0</state><rule><modify>
			    <srcmask>0</srcmask>
			    <next><rule><modify>
				<src><y>1</y></src><srcmask>ff9</srcmask><hexinc>49</hexinc><dest></dest>
				<next><rule><modify>
				    <srcmask>0</srcmask><hexinc>2000000000001</hexinc><dest><y>1</y></dest>
				</modify></rule></next>
			    </modify></rule></next>
			</modify></rule></case>
		    </switch></rule></pass>

		    <fail><rule><switch>
			<pos><y>-1</y></pos>
			<mask>ffff000000000000</mask>
			<case><state>0</state><rule><modify>
			    <srcmask>0</srcmask>
			    <next><rule><modify>
				<src><y>-1</y></src><srcmask>ff9</srcmask><hexinc>49</hexinc><dest></dest>
				<next><rule><modify>
				      <srcmask>0</srcmask><hexinc>2000000000001</hexinc><dest><y>-1</y></dest>
				</modify></rule></next>
			    </modify></rule></next>
			</modify></rule></case>
		    </switch></rule></fail>

		</random></rule></fail>
	    </random></rule></fail>
	  </random></rule>

	</particle>
	
      </grammar><init><x>64</x><y>64</y><type>1</type></init></board>

    <rate>240</rate> <!-- 240 updates/second is about as fast as we can clock it -->

    <tool>
      <name>tool1</name>
      <size>8</size>
      <hexstate>1000000000000</hexstate>
      <reserve>100</reserve>
      <recharge>100</recharge>
    </tool>

    <tool>
      <name>tool2</name>
      <size>4</size>
      <hexstate>2000000000000</hexstate>
      <reserve>50</reserve>
      <recharge>100</recharge>
    </tool>

    <exit><type>1</type><pos><x>12</x><y>12</y></pos></exit>

    <goal><and>
      <lazy/>
      <goal><cached>
	<goal><population>
	  <type>1</type>
	  <type>2</type>
	  <count><min>20</min></count>
	</population></goal>
      </cached></goal>
      <goal><cached>
	<reps>3</reps>
	<goal><print>
	  <message>You have reached your population target.
	    I will say this three times.</message>
	</print></goal>
      </cached></goal>
      <goal><cached>
	<goal><repeat>
	  <reps>5</reps>
	  <goal><print>
	    <message>(pauses for effect)</message>
	  </print></goal>
	</repeat></goal>
      </cached></goal>
      <goal><cached>
	<goal><and>
	  <lazy/>
	  <cache/>
	  <goal><print><message>The portal is opening...</message></print></goal>
	  <goal><print><message>...wait for it...</message></print></goal>
	  <goal><print><message>...right about NOW!</message></print></goal>
	</and></goal>
      </cached></goal>
      <goal><cached>
	<goal><setexit>
	  <exitstate>PortalCounting</exitstate>
	</setexit></goal>
      </cached></goal>
    </and></goal>
  </game>
